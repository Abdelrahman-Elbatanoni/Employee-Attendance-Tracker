@model PagedResult<AttendanceRecord>

@{
    ViewData["Title"] = "Attendance Management";
    var currentDepartmentId = ViewBag.DepartmentId;
    var currentEmployeeId = ViewBag.EmployeeId;
    var currentFrom = ViewBag.From;
    var currentTo = ViewBag.To;
}

<h2 class="mb-4">Attendance Management</h2>

<!-- ========================== FILTER SECTION ========================== -->
<div class="card mb-4">
    <div class="card-header fw-bold">Apply Filters</div>
    <div class="card-body row">
        <div class="col-md-3">
            <label>Department</label>
            <select id="filterDepartment" class="form-control" asp-items="ViewBag.Departments">
                <option value="">-- All Departments --</option>
            </select>
        </div>
        <div class="col-md-3">
            <label>Employee</label>
            <select id="filterEmployee" class="form-control">
                <option value="">-- Select Employee --</option>
            </select>
        </div>
        <div class="col-md-3">
            <label>From</label>
            <input type="date" id="filterFrom" class="form-control" value="@currentFrom" />
        </div>
        <div class="col-md-3">
            <label>To</label>
            <input type="date" id="filterTo" class="form-control" value="@currentTo" />
        </div>
    </div>
    <div class="card-footer">
        <button class="btn btn-primary" onclick="filterAttendance()">Apply Filter</button>
        <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
    </div>
</div>

<!-- ========================== ATTENDANCE TABLE ========================== -->
<div class="card mb-4">
    <div class="card-header fw-bold">Attendance Records</div>
    <div class="card-body row">
        <div id="attendanceTable">
            @Html.Partial("AttendanceTable", Model)
        </div>
    </div>
</div>


<hr />

<!-- ========================== MARK ATTENDANCE SECTION ========================== -->
<div class="card mt-4">
    <div class="card-header fw-bold">Create or Update Attendance</div>
    <div class="card-body row">
        <div class="col-md-3">
            <label>Department</label>
            <select id="markDepartment" class="form-control" asp-items="ViewBag.Departments">
                <option value="">-- Select Department --</option>
            </select>
        </div>
        <div class="col-md-3">
            <label>Employee</label>
            <select id="markEmployee" class="form-control">
                <option value="">-- Select Employee --</option>
            </select>
        </div>
        <div class="col-md-3">
            <label>Date</label>
            <input type="date" id="markDate" class="form-control"
                   max="@DateTime.Today.ToString("yyyy-MM-dd")" />
        </div>
        <div class="col-md-3">
            <label>Status</label>
            <select id="markStatus" class="form-control">
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
            </select>
        </div>
    </div>
    <div class="card-footer">
        <button class="btn btn-success" onclick="submitAttendance()">Submit Attendance</button>
        <div class="mt-2 text-info" id="currentStatus"></div>
    </div>
</div>

<!-- ========================== SCRIPTS ========================== -->
@section Scripts {
    <script src="~/js/attendance.js"></script>
    <script>
        // Set initial filter values
        $(document).ready(function() {
            if ('@currentDepartmentId' !== '') {
                $('#filterDepartment').val('@currentDepartmentId');
                updateEmployeeDropdown('#filterEmployee', '@currentDepartmentId');
            }
            if ('@currentEmployeeId' !== '') {
                setTimeout(function() {
                    $('#filterEmployee').val('@currentEmployeeId');
                }, 500);
            }
        });
    </script>
}
